<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vivora Fashion Illustration 2025</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#f3ece7;
    --panel:#f7f2ee;
    --line:#e1d9d4;
    --text:#333;
    --accent:#222;
    --shadow:0 6px 18px rgba(0,0,0,.06);
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    background:var(--bg);
    color:var(--text);
    font-family:system-ui,-apple-system,"Helvetica Neue",Arial,sans-serif;
  }

  /* 全体レイアウト：左=キャンバス、右=サイドバー */
  .app{
    display:grid;
    grid-template-columns: 1fr 320px;
    grid-template-rows: auto 1fr;
    grid-template-areas:
      "canvas  sidebar"
      "canvas  sidebar";
    height:100vh;
  }

  /* ===== キャンバス ===== */
  .canvas-area{
    grid-area:canvas;
    display:flex;
    flex-direction:column;
    overflow:hidden;
    padding:16px;
  }
  .board{
    position:relative;
    flex:1;
    background:#fff;
    border:1px solid var(--line);
    border-radius:12px;
    box-shadow:var(--shadow);
    overflow:hidden;              /* ← ここでハミ出し禁止 */
  }

  /* 方眼紙 */
  .board.grid::before{
    content:"";
    position:absolute;inset:0;
    background-image:
      linear-gradient(rgba(0,0,0,.06) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,0,0,.06) 1px, transparent 1px);
    background-size:24px 24px;
    pointer-events:none;
  }

  /* ステージ（Pan/Zoomの対象） */
  #stage{
    position:absolute;left:0;top:0;
    transform-origin:0 0;
    touch-action:none;
    cursor:grab;
  }
  #stage.grabbing{cursor:grabbing}

  .mannequin-base{
    display:block;
    max-width:none;     /* 実寸ベースで拡大縮小 */
    width:600px;        /* 初期見やすさ用の仮幅 */
    height:auto;
    user-select:none;
    -webkit-user-drag:none;
  }

  /* ===== キャンバス上 HUD（左/上/右） ===== */
  .hud-left,.hud-top,.hud-right{
    position:absolute; z-index:10; display:flex; gap:8px; align-items:center;
  }
  .hud-left{ top:10px; left:10px; }
  .hud-top { top:10px; left:50%; transform:translateX(-50%); gap:12px; }
  .hud-right{ top:10px; right:10px; gap:10px; }

  .chip, .icon-sq, .content-btn{
    background:#fff;border:1px solid var(--line);border-radius:10px;
    display:flex;align-items:center;justify-content:center;
    box-shadow:0 4px 10px rgba(0,0,0,.05);
  }

  /* Gender（左） */
  .gender{ display:flex; gap:6px; }
  .gender .chip{
    padding:6px 12px; font-size:13px; cursor:pointer;
  }
  .gender .active{ background:var(--accent); color:#fff; border-color:var(--accent); }

  /* 中央ツール群（安定版のアイコン） */
  .icon-sq{ width:32px;height:32px; cursor:pointer; }
  .icon-sq img{ width:18px;height:18px; display:block; }

  /* コンテンツ（右） */
  .content-btn{ width:38px;height:38px; cursor:pointer; }
  .content-btn img{ width:24px;height:24px; display:block; }
  .content-btn:hover{ transform:translateY(-1px); box-shadow:var(--shadow); }

  /* ===== サイドバー ===== */
  aside{
    grid-area:sidebar;
    padding:16px;
    border-left:1px solid var(--line);
    background:var(--panel);
    overflow:auto;
  }
  .panel{background:#fff;border:1px solid var(--line);border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:var(--shadow)}
  .panel h3{font:500 16px/1 'Playfair Display',serif;margin-bottom:10px}

  .grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  .tool-tile,.color-tile{
    width:56px;height:56px;border:1px solid var(--line);border-radius:10px;background:#fff;
    display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.15s
  }
  .tool-tile img{width:30px;height:30px}
  .tool-tile:hover,.color-tile:hover{transform:translateY(-2px);box-shadow:0 8px 18px rgba(0,0,0,.08)}

  /* Zoom / Opacity（Reset は折り返さない） */
  .row{display:flex;align-items:center;gap:10px}
  .row > *{flex:0 0 auto}
  .row .stretch{flex:1 1 auto; min-width:0}
  input[type="range"]{width:100%}
  .meta{display:flex;justify-content:space-between;gap:10px;margin-top:6px;font-size:13px;opacity:.8}
  .btn{border:1px solid var(--line);background:#fff;border-radius:8px;padding:4px 10px;cursor:pointer}
  .btn:hover{background:#fafafa}

  /* カラー */
  .color-tile{border:none}
  .color-tile.add{font-size:22px;color:#bbb;border:1px dashed var(--line);background:#fafafa}
</style>
</head>
<body>
<div class="app">

  <!-- ===== キャンバス ===== -->
  <section class="canvas-area">
    <div id="board" class="board">
      <!-- HUD 左：Gender -->
      <div class="hud-left">
        <div class="gender">
          <button class="chip gbtn active" data-gender="woman">Woman</button>
          <button class="chip gbtn" data-gender="man">Man</button>
          <button class="chip gbtn" data-gender="kids">Kids</button>
        </div>
      </div>

      <!-- HUD 上部中央：安定版ツール群（方眼紙含む） -->
      <div class="hud-top">
        <button class="icon-sq" id="btn-undo" title="Undo"><img src="../../create_parts/create_button/retreat.png" alt=""></button>
        <button class="icon-sq" id="btn-redo" title="Redo"><img src="../../create_parts/create_button/forward.png" alt=""></button>
        <button class="icon-sq" id="btn-reset" title="Reset"><img src="../../create_parts/create_button/reset.png" alt=""></button>
        <button class="icon-sq" id="btn-download" title="Download"><img src="../../create_parts/create_button/download.png" alt=""></button>
        <button class="icon-sq" id="btn-upload" title="Upload"><img src="../../create_parts/create_button/upload.png" alt=""></button>
        <button class="icon-sq" id="btn-save" title="Save"><img src="../../create_parts/create_button/save.png" alt=""></button>
        <button class="icon-sq" id="grid-toggle" title="Grid"><img src="../../create_parts/create_button/graph_paper.png" alt=""></button>
      </div>

      <!-- HUD 右：コンテンツアイコン -->
      <div class="hud-right">
        <button class="content-btn" data-link="/"><img src="../../create_parts/contents_button/0_home.png" alt=""></button>
        <button class="content-btn" data-link="/public/work/illustration/illustration.html"><img src="../../create_parts/contents_button/1_fashion-illustrations.png" alt=""></button>
        <button class="content-btn" data-link="/public/work/fabric/index.html"><img src="../../create_parts/contents_button/2_fabric-matching.png" alt=""></button>
        <button class="content-btn" data-link="/public/work/clothing/index.html"><img src="../../create_parts/contents_button/3_clothing-design.png" alt=""></button>
        <button class="content-btn" data-link="/public/work/pattern/index.html"><img src="../../create_parts/contents_button/4_pattern-creation.png" alt=""></button>
        <button class="content-btn" data-link="/public/work/grading/index.html"><img src="../../create_parts/contents_button/5_grading.png" alt=""></button>
        <button class="content-btn" data-link="/public/work/print/index.html"><img src="../../create_parts/contents_button/6_print-layout-cut.png" alt=""></button>
        <button class="content-btn" data-link="/public/work/digital-kids/index.html"><img src="../../create_parts/contents_button/digital-dressing-kids-mode.png" alt=""></button>
      </div>

      <!-- ステージ（Pan/Zoom対象） -->
      <div id="stage">
        <img id="mannequin" class="mannequin-base" src="../../mannequin/mannequin_woman.png" alt="Mannequin">
      </div>
    </div>
  </section>

  <!-- ===== サイドバー ===== -->
  <aside>

    <div class="panel">
      <h3>Stationery</h3>
      <div class="grid-4" id="stGrid">
        <div class="tool-tile"><img src="../../create_parts/design_button/select.png" alt=""></div>
        <div class="tool-tile"><img src="../../create_parts/design_button/direct_select.png" alt=""></div>
        <div class="tool-tile"><img src="../../create_parts/design_button/sentence.png" alt=""></div>
        <div class="tool-tile"><img src="../../create_parts/design_button/fill.png" alt=""></div>

        <div class="tool-tile"><img src="../../create_parts/design_button/pen.png" alt=""></div>
        <div class="tool-tile"><img src="../../create_parts/design_button/brush.png" alt=""></div>
        <div class="tool-tile"><img src="../../create_parts/design_button/eraser.png" alt=""></div>
        <div class="tool-tile"><img src="../../create_parts/design_button/rotate.png" alt=""></div>

        <div class="tool-tile"><img src="../../create_parts/design_button/percent.png" alt=""></div>
        <div class="tool-tile"><img src="../../create_parts/design_button/photo.png" alt=""></div>
        <div class="tool-tile"><img src="../../create_parts/design_button/add.png" alt=""></div>
        <div class="tool-tile"><img src="../../create_parts/design_button/shapes.png" alt=""></div>
      </div>
    </div>

    <!-- Zoom -->
    <div class="panel">
      <h3>Zoom</h3>
      <div class="row">
        <button class="btn" id="zoomOutBtn">−</button>
        <div class="stretch"><input type="range" id="zoomRange" min="25" max="600" value="100" step="1"></div>
        <button class="btn" id="zoomInBtn">＋</button>
      </div>
      <div class="meta">
        <span id="zoomVal">100%</span>
        <button class="btn" id="zoomResetBtn">Reset</button>
      </div>
    </div>

    <!-- Opacity -->
    <div class="panel">
      <h3>Opacity</h3>
      <div class="row">
        <div class="stretch"><input type="range" id="opacityRange" min="0" max="100" value="100"></div>
        <span id="opacityVal" style="opacity:.8">100%</span>
      </div>
    </div>

    <!-- Color -->
    <div class="panel">
      <h3>Color</h3>
      <div class="grid-4" id="colorGrid">
        <button class="color-tile" style="background:#ffffff" data-color="#ffffff"></button>
        <button class="color-tile" style="background:#cccccc" data-color="#cccccc"></button>
        <button class="color-tile" style="background:#ffff00" data-color="#ffff00"></button>
        <button class="color-tile" style="background:#ff9900" data-color="#ff9900"></button>

        <button class="color-tile" style="background:#f4a2a2" data-color="#f4a2a2"></button>
        <button class="color-tile" style="background:#ff0000" data-color="#ff0000"></button>
        <button class="color-tile" style="background:#009900" data-color="#009900"></button>
        <button class="color-tile" style="background:#006600" data-color="#006600"></button>

        <button class="color-tile" style="background:#3399ff" data-color="#3399ff"></button>
        <button class="color-tile" style="background:#0000ff" data-color="#0000ff"></button>
        <button class="color-tile" style="background:#990099" data-color="#990099"></button>
        <button class="color-tile" style="background:#000000" data-color="#000000"></button>

        <!-- スポイト（表示復活） -->
        <button class="color-tile" title="Eyedropper">
          <img src="../../create_parts/design_button/eyedropper.png" alt="eyedropper" style="width:30px;height:30px">
        </button>
      </div>
    </div>

  </aside>
</div>

<script>
/* ========== Pan & Zoom（キャンバス内に限定） ========== */
(() => {
  const wrapper = document.getElementById('board');
  const stage   = document.getElementById('stage');
  const img     = document.getElementById('mannequin');

  let scale=1, tx=0, ty=0; const MIN=.25, MAX=6, SPEED=1.0015;
  const apply = ()=> stage.style.transform = `translate(${tx}px,${ty}px) scale(${scale})`;

  // 初期フィット（はみ出さない最大）
  function fit(){
    const rect=wrapper.getBoundingClientRect();
    const iw=img.naturalWidth||img.width, ih=img.naturalHeight||img.height;
    if(!iw||!ih) return;
    const m=80, kx=(rect.width-m)/iw, ky=(rect.height-m)/ih;
    scale=Math.min(Math.max(Math.min(kx,ky),MIN),3);
    tx=(rect.width-iw*scale)/2;
    ty=(rect.height-ih*scale)/2;
    apply(); ZoomUI.update(scale);
  }

  // Drag Pan
  let dragging=false, sx=0, sy=0, stx=0, sty=0;
  const start=(x,y)=>{dragging=true; sx=x; sy=y; stx=tx; sty=ty; stage.classList.add('grabbing');}
  const move =(x,y)=>{ if(!dragging) return; tx=stx+(x-sx); ty=sty+(y-sy); apply(); }
  const end  =()=>{dragging=false; stage.classList.remove('grabbing');}

  wrapper.addEventListener('pointerdown', e=>{
    if(e.button===2) return;
    stage.setPointerCapture(e.pointerId);
    start(e.clientX,e.clientY);
  });
  wrapper.addEventListener('pointermove', e=>move(e.clientX,e.clientY));
  wrapper.addEventListener('pointerup', end);
  wrapper.addEventListener('pointercancel', end);

  // Wheel Zoom / Pinch Zoom
  wrapper.addEventListener('wheel', e=>{
    const zoomIntent = e.ctrlKey || Math.abs(e.deltaY) > Math.abs(e.deltaX);
    if(!zoomIntent) return;
    e.preventDefault();

    const rect=wrapper.getBoundingClientRect();
    const cx=e.clientX-rect.left-tx, cy=e.clientY-rect.top-ty;
    const k=Math.pow(SPEED,-e.deltaY);
    const next = clamp(scale*k, MIN, MAX);
    const ratio=next/scale;

    tx = e.clientX-rect.left - ratio*cx;
    ty = e.clientY-rect.top  - ratio*cy;
    scale = next;
    apply(); ZoomUI.update(scale);
  }, {passive:false});

  // 2本指ピンチ（モバイル）
  let t1=null,t2=null, dist0=0, scale0=1, mid0={x:0,y:0}, tx0=0,ty0=0;
  const dist=(a,b)=>Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY);
  const mid =(a,b)=>({x:(a.clientX+b.clientX)/2,y:(a.clientY+b.clientY)/2});

  wrapper.addEventListener('touchstart', e=>{
    if(e.touches.length===1){ const t=e.touches[0]; start(t.clientX,t.clientY); }
    else if(e.touches.length===2){
      t1=e.touches[0]; t2=e.touches[1];
      dist0=dist(t1,t2); scale0=scale; mid0=mid(t1,t2); tx0=tx; ty0=ty;
    }
  },{passive:false});

  wrapper.addEventListener('touchmove', e=>{
    if(e.touches.length===1 && dragging){
      const t=e.touches[0]; move(t.clientX,t.clientY);
    }else if(e.touches.length===2){
      e.preventDefault();
      const a=e.touches[0], b=e.touches[1];
      const rect=wrapper.getBoundingClientRect();
      const next = clamp((dist(a,b)/dist0)*scale0, MIN, MAX);
      const ratio=next/scale;
      const mx = mid0.x-rect.left - tx0;
      const my = mid0.y-rect.top  - ty0;
      tx = tx0 + (1-ratio)*mx;
      ty = ty0 + (1-ratio)*my;
      scale=next; apply(); ZoomUI.update(scale);
    }
  },{passive:false});
  wrapper.addEventListener('touchend', end,{passive:true});
  wrapper.addEventListener('touchcancel', end,{passive:true});

  function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

  window.addEventListener('load',fit);
  window.addEventListener('resize',fit);

  window.ZoomAPI = {
    getScale: ()=>scale,
    zoomTo: (newScale, focal=null)=>{
      newScale = clamp(newScale, MIN, MAX);
      const rect=wrapper.getBoundingClientRect();
      const cx = (focal?.x ?? rect.width/2) - tx;
      const cy = (focal?.y ?? rect.height/2) - ty;
      const ratio = newScale/scale;
      tx = (focal?.x ?? rect.width/2) - ratio*cx;
      ty = (focal?.y ?? rect.height/2) - ratio*cy;
      scale = newScale; apply(); ZoomUI.update(scale);
    },
    step: (delta)=> ZoomAPI.zoomTo(scale+delta),
    reset: ()=> fit()
  };
})();

/* ========== ズームUI（はみ出し防止済み） ========== */
const ZoomUI = (()=> {
  const range = ()=>document.getElementById('zoomRange');
  const val   = ()=>document.getElementById('zoomVal');
  const s2v = s => Math.round(s*100);   // 実倍率→パーセント
  const v2s = v => v/100;               // パーセント→実倍率

  function update(scale){
    if(!range()) return;
    range().value = String(s2v(scale));
    val().textContent = s2v(scale) + '%';
  }

  window.addEventListener('DOMContentLoaded', ()=>{
    const r=range(); if(!r) return;
    document.getElementById('zoomInBtn').addEventListener('click', ()=> ZoomAPI.step(+0.1));
    document.getElementById('zoomOutBtn').addEventListener('click',()=> ZoomAPI.step(-0.1));
    document.getElementById('zoomResetBtn').addEventListener('click',()=> ZoomAPI.reset());
    r.addEventListener('input', ()=> ZoomAPI.zoomTo(v2s(parseInt(r.value,10))));
    update(1);
  });

  return {update};
})();

/* ========== UI配線（性別・ツール・色・方眼紙など） ========== */
window.addEventListener('DOMContentLoaded', () => {
  const $ = s => document.querySelector(s);

  // Gender
  document.querySelectorAll('.gbtn').forEach(b=>{
    b.addEventListener('click', ()=>{
      document.querySelectorAll('.gbtn').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      const map={
        woman:'../../mannequin/mannequin_woman.png',
        man  :'../../mannequin/mannequin_man.png',
        kids :'../../mannequin/mannequin_kids.png'
      };
      $('#mannequin').src = map[b.dataset.gender] || map.woman;
      ZoomAPI.reset();
    });
  });

  // Content buttons（右上）
  document.querySelectorAll('.content-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const link = btn.dataset.link;
      if(link) location.href = link;
    });
  });

  // Undo / Redo / Reset / Download / Upload / Save / Grid
  $('#btn-undo')?.addEventListener('click', ()=>history.back());     // 実装は用途に応じて
  $('#btn-redo')?.addEventListener('click', ()=>history.forward());  // （プレースホルダ）
  $('#btn-reset')?.addEventListener('click', ()=> ZoomAPI.reset());
  $('#btn-download')?.addEventListener('click', ()=>{/* TODO */});
  $('#btn-upload')?.addEventListener('click', ()=>{/* TODO */});
  $('#btn-save')?.addEventListener('click', ()=>{/* TODO */});
  $('#grid-toggle')?.addEventListener('click', ()=> document.getElementById('board').classList.toggle('grid'));

  // Opacity
  const opRange = document.getElementById('opacityRange');
  const opVal   = document.getElementById('opacityVal');
  opRange.addEventListener('input', ()=>{
    const v=Number(opRange.value);
    opVal.textContent = v + '%';
    document.getElementById('mannequin').style.opacity = v/100;
  });

  // Color（スポイトは表示のみ。動作は実装時に）
  document.querySelectorAll('#colorGrid .color-tile[data-color]').forEach(c=>{
    c.addEventListener('click', ()=> {
      // 将来：選択レイヤーにtint適用等
    });
  });
});
</script>
</body>
</html>
