<!DOCTYPE html>
<html lang="ja" data-theme="system">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vivora Fashion Illustration 2025</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div class="viewport">
    <div class="app" role="application" aria-label="Vivora Fashion Illustration 2025">

      <!-- 1ÊÆµÁõÆÔºö„Çø„Ç§„Éà„É´ / history -->
      <header class="top-strip">
        <h1 class="title">Vivora Fashion Illustration 2025</h1>
        <div class="history-tool" aria-label="history">
          <img src="/create_parts/create_button/retreat.png"  alt="Êàª„Çã"     title="Êàª„Çã" draggable="false"/>
          <img src="/create_parts/create_button/forward.png"  alt="ÈÄ≤„ÇÄ"     title="ÈÄ≤„ÇÄ" draggable="false"/>
          <img src="/create_parts/create_button/reset.png"    alt="„É™„Çª„ÉÉ„Éà" title="„É™„Çª„ÉÉ„Éà" draggable="false"/>
          <img src="/create_parts/create_button/download.png" alt="DL"       title="„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ" draggable="false"/>
          <img src="/create_parts/create_button/upload.png"   alt="UP"       title="„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ" draggable="false"/>
          <img src="/create_parts/create_button/save.png"     alt="‰øùÂ≠ò"     title="‰øùÂ≠ò" draggable="false"/>
        </div>
      </header>

      <!-- 2ÊÆµÁõÆÔºöNext Step + contents -->
      <div class="nav-strip">
        <button id="next-step" class="ghost-btn" type="button">Next Step ‚ñ∂‚ñ∂</button>
        <nav class="contents-button" aria-label="contents">
          <img src="/create_parts/contents_button/0_home.png" alt="Home"  title="Home" draggable="false"/>
          <img src="/create_parts/contents_button/1_fashion-illustrations.png" alt="Fi"  title="Fashion Illustrations" draggable="false"/>
          <img src="/create_parts/contents_button/2_fabric-matching.png"       alt="Fm"  title="Fabric Matching" draggable="false"/>
          <img src="/create_parts/contents_button/3_clothing-design.png"        alt="Cd"  title="Clothing Design" draggable="false"/>
          <img src="/create_parts/contents_button/4_pattern-creation.png"       alt="Pc"  title="Pattern Creation" draggable="false"/>
          <img src="/create_parts/contents_button/5_grading.png"                alt="Gd"  title="Grading" draggable="false"/>
          <img src="/create_parts/contents_button/6_print-layout-cut.png"       alt="Plc" title="Print/Layout/Cut" draggable="false"/>
          <img src="/create_parts/contents_button/digital-dressing-kids-mode.png" alt="Dk" title="Digital Dressing (Kids)" draggable="false"/>
        </nav>
      </div>

      <!-- „Ç≠„É£„É≥„Éê„Çπ -->
      <main class="board" role="main">
        <div class="canvas-wrapper" id="canvas">

          <!-- StationeryÔºàÂè≥‰∏ä„Éª8È†ÖÁõÆÂàó„ÅÆ„ÅÜ„Å°3„Å§„Çí„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥ÂåñÔºâ -->
          <div class="stationery-toolbar" id="stationery" aria-label="stationery">
            <!-- SelectÔºàÈÄöÂ∏∏/„ÉÄ„Ç§„É¨„ÇØ„ÉàÔºâ -->
            <button class="tool-trigger" id="trigger-select"
              aria-haspopup="menu" aria-expanded="false" data-tool="select" title="Select (V/A)">
              <img id="icon-select-current" src="/create_parts/object_btn/select.png" alt="Select" draggable="false">
              <span class="caret"></span>
            </button>
            <!-- BoxÔºàÈï∑ÊñπÂΩ¢/ÂÜÜÔºâ -->
            <button class="tool-trigger" id="trigger-box"
              aria-haspopup="menu" aria-expanded="false" data-tool="box" title="Shape (M/O)">
              <img id="icon-box-current" src="/create_parts/object_btn/square.png" alt="Box" draggable="false">
              <span class="caret"></span>
            </button>
            <!-- PenÔºà„Éñ„É©„Ç∑/ÈâõÁ≠Ü/Ê∂à„Åó„Ç¥„É†Ôºâ -->
            <button class="tool-trigger" id="trigger-pen"
              aria-haspopup="menu" aria-expanded="false" data-tool="pen" title="Pen/Brush/Eraser (B/P/E)">
              <img id="icon-pen-current" src="/create_parts/object_btn/brush.png" alt="Pen" draggable="false">
              <span class="caret"></span>
            </button>

            <!-- ÊÆã„Çä„ÅÆÂ∏∏Ë®≠„Ç¢„Ç§„Ç≥„É≥Ôºà4„Å§„Å†„ÅëÔºâ -->
            <img src="/create_parts/object_btn/sentence.png"    alt="Text"    title="„ÉÜ„Ç≠„Çπ„Éà (T)" draggable="false" data-quick="text"/>
            <img src="/create_parts/object_btn/opasity_ber.png" alt="Opacity" title="‰∏çÈÄèÊòéÂ∫¶ (O)" draggable="false" data-quick="opacity"/>
            <img src="/create_parts/object_btn/graph_paper.png" alt="Grid"    title="ÊñπÁúºÁ¥ô" draggable="false" data-quick="grid"/>
            <img src="/create_parts/object_btn/layer.png"       alt="Layer"   title="„É¨„Ç§„É§„Éº" draggable="false" data-quick="layer"/>
          </div>

          <!-- ‚ñº „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥ÔºöSelect -->
          <div class="dropdown hide" id="menu-select" role="menu" aria-label="Select menu">
            <button class="menuitem" role="menuitemradio" data-sub="select"
                    data-icon="/create_parts/object_btn/select.png" title="ÈÄöÂ∏∏ÈÅ∏Êäû (V)">
              <img src="/create_parts/object_btn/select.png" alt=""><span>ÈÄöÂ∏∏ÈÅ∏Êäû</span>
            </button>
            <button class="menuitem" role="menuitemradio" data-sub="direct"
                    data-icon="/create_parts/object_btn/direct_select.png" title="„ÉÄ„Ç§„É¨„ÇØ„ÉàÈÅ∏Êäû (A)">
              <img src="/create_parts/object_btn/direct_select.png" alt=""><span>„ÉÄ„Ç§„É¨„ÇØ„ÉàÈÅ∏Êäû</span>
            </button>
            <label class="pin"><input type="checkbox" id="pin-select">üìå Âõ∫ÂÆö</label>
          </div>

          <!-- ‚ñº „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥ÔºöBox -->
          <div class="dropdown hide" id="menu-box" role="menu" aria-label="Box menu">
            <button class="menuitem" role="menuitemradio" data-sub="rect"
                    data-icon="/create_parts/object_btn/square.png" title="Èï∑ÊñπÂΩ¢ (M)">
              <img src="/create_parts/object_btn/square.png" alt=""><span>Èï∑ÊñπÂΩ¢</span>
            </button>
            <button class="menuitem" role="menuitemradio" data-sub="ellipse"
                    data-icon="/create_parts/object_btn/ellipse.png" title="ÂÜÜ (O)">
              <img src="/create_parts/object_btn/ellipse.png" alt=""><span>ÂÜÜ</span>
            </button>
            <label class="pin"><input type="checkbox" id="pin-box">üìå Âõ∫ÂÆö</label>
          </div>

          <!-- ‚ñº „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥ÔºöPen -->
          <div class="dropdown hide" id="menu-pen" role="menu" aria-label="Pen menu">
            <button class="menuitem" role="menuitemradio" data-sub="brush"
                    data-icon="/create_parts/object_btn/brush.png" title="„Éñ„É©„Ç∑ (B)">
              <img src="/create_parts/object_btn/brush.png" alt=""><span>„Éñ„É©„Ç∑</span>
            </button>
            <button class="menuitem" role="menuitemradio" data-sub="pencil"
                    data-icon="/create_parts/object_btn/pencil.png" title="ÈâõÁ≠Ü (P)">
              <img src="/create_parts/object_btn/pencil.png" alt=""><span>ÈâõÁ≠Ü</span>
            </button>
            <button class="menuitem" role="menuitemradio" data-sub="eraser"
                    data-icon="/create_parts/object_btn/eraser.png" title="Ê∂à„Åó„Ç¥„É† (E)">
              <img src="/create_parts/object_btn/eraser.png" alt=""><span>Ê∂à„Åó„Ç¥„É†</span>
            </button>
            <label class="pin"><input type="checkbox" id="pin-pen">üìå Âõ∫ÂÆö</label>
          </div>

          <!-- ‚ñº „Éö„É≥Áî®Ôºö„Ç´„É©„ÉºÁ∏¶„Éë„Éç„É´ -->
          <aside id="color-panel" class="color-panel hide" aria-label="Color panel">
            <!-- 12Ëâ≤ + ËøΩÂä† + „Çπ„Éù„Ç§„ÉàÔºàÈ†ÜÂ∫è„ÅØÊ∑ª‰ªò„Ç§„É°„Éº„Ç∏Ê∫ñÊã†Ôºâ -->
            <button class="swatch" data-color="#FFFFFF" title="White"></button>
            <button class="swatch" data-color="#BDBDBD" title="Gray"></button>
            <button class="swatch" data-color="#FFD400" title="Yellow"></button>
            <button class="swatch" data-color="#F39C12" title="Orange"></button>
            <button class="swatch" data-color="#F5A3A3" title="Pink"></button>
            <button class="swatch" data-color="#E31E24" title="Red"></button>
            <button class="swatch" data-color="#5EC255" title="Light Green"></button>
            <button class="swatch" data-color="#0E7F54" title="Green"></button>
            <button class="swatch" data-color="#89C7E7" title="Sky"></button>
            <button class="swatch" data-color="#0C4DB7" title="Blue"></button>
            <button class="swatch" data-color="#6E2C91" title="Purple"></button>
            <button class="swatch" data-color="#8C2A24" title="Brown"></button>
            <button class="swatch" data-color="#6B6B6B" title="Dark Gray"></button>
            <button class="swatch" data-color="#000000" title="Black"></button>

            <button class="swatch add"  data-action="add"     title="Ëâ≤„ÇíËøΩÂä†">+</button>
            <button class="swatch pick" data-action="eyedrop" title="„Çπ„Éù„Ç§„Éà">
              <img src="/create_parts/object_btn/eyedropper.png" alt="">
            </button>
          </aside>

          <!-- ‚ñº ‰∏çÈÄèÊòéÂ∫¶ HUD -->
          <div id="opacity-hud" class="opacity-hud hide" role="dialog" aria-label="Opacity">
            <div class="hud-row">
              <span id="opacity-label">100 %</span>
              <button id="opacity-pin" class="hud-pin" title="Âõ∫ÂÆö">üìå</button>
            </div>
            <input id="opacity-range" type="range" min="0" max="100" value="100" step="1" />
          </div>

          <!-- „Éû„Éç„Ç≠„É≥Ôºà„Éî„É≥„ÉÅÔºã‰∫åÊú¨Êåá„Éë„É≥Ôºâ -->
          <div id="man-zoom">
            <img id="mannequin"
                 src="/mannequin/mannequin_woman/mannequin_woman_front.png"
                 alt="Mannequin (Woman Front)" draggable="false"/>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    // ====== Áä∂ÊÖã ======
    const state = {
      currentTool: 'select',
      subTool: { select:'select', box:'rect', pen:'brush' },
      color: '#000000',
      opacity: 100,
      timers: { hud: null },
    };
    const $  = s=>document.querySelector(s);
    const $$ = s=>[...document.querySelectorAll(s)];
    const hide = el=>el.classList.add('hide');
    const show = el=>el.classList.remove('hide');

    // ====== Êó¢Â≠òÔºö„Éï„Ç£„ÉÉ„Éà & HistoryÂêåÊúü ======
    (function(){ const css=()=>getComputedStyle(document.documentElement), num=v=>parseFloat(v)||0;
      function snap(baseW,baseH,vw,vh){ const raw=Math.max(0.5,Math.min(vw/baseW,vh/baseH));
        const s=Math.min(Math.floor(baseW*raw)/baseW, Math.floor(baseH*raw)/baseH);
        const dpr=window.devicePixelRatio||1; return Math.max(0.5, Math.round(s*dpr*2)/(dpr*2)); }
      function fit(){ const W=num(css().getPropertyValue('--base-w'))||1280, H=num(css().getPropertyValue('--base-h'))||820;
        const M=num(css().getPropertyValue('--viewport-margin'))||24;
        document.documentElement.style.setProperty('--app-scale', snap(W,H, innerWidth-M*2, innerHeight-M*2)); }
      addEventListener('resize',fit,{passive:true}); addEventListener('orientationchange',fit,{passive:true}); document.addEventListener('DOMContentLoaded',fit);
    })();
    (function(){ function sync(){
        const c=$('#canvas')?.getBoundingClientRect(), s=$('#stationery')?.getBoundingClientRect(), h=document.querySelector('.history-tool');
        if(!c||!s||!h) return; const pad=parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--board-pad'))||14;
        h.style.marginRight = `${Math.max(0, Math.round(c.right - s.right)) + pad}px`; }
      addEventListener('resize',sync,{passive:true}); addEventListener('load',sync,{passive:true}); new ResizeObserver(sync).observe(document.body);
    })();

    // ====== „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥ÂÖ±ÈÄö ======
    const menus = { select:$('#menu-select'), box:$('#menu-box'), pen:$('#menu-pen') };
    const icons = { select:$('#icon-select-current'), box:$('#icon-box-current'), pen:$('#icon-pen-current') };
    const pins  = { select:$('#pin-select'), box:$('#pin-box'), pen:$('#pin-pen') };

    function closeAll(except){
      for(const [name,menu] of Object.entries(menus)){
        if(name===except && pins[name]?.checked) continue;
        hide(menu); document.querySelector(`.tool-trigger[data-tool="${name}"]`)?.setAttribute('aria-expanded','false');
      }
    }
    function openMenu(name, trg){
      closeAll(name); positionMenu(menus[name], trg); show(menus[name]); trg.setAttribute('aria-expanded','true');
      menus[name].querySelector('.menuitem')?.focus({preventScroll:true});
    }
    function positionMenu(menu,trg){
      const parent=$('#stationery').offsetParent.getBoundingClientRect();
      const t=trg.getBoundingClientRect();
      menu.style.left=(t.left - parent.left)+'px';
      menu.style.top =(t.bottom - parent.top + 6)+'px';
    }

    // „Éà„É™„Ç¨„ÉºÔºöÁü≠Êäº„ÅóÔºùÁõ¥Ëøë„ÄÅÈï∑Êäº„ÅóÔºù„É°„Éã„É•„Éº
    $$('.tool-trigger').forEach(trg=>{
      let timer=null;
      trg.addEventListener('mousedown', ()=>{ timer=setTimeout(()=>openMenu(trg.dataset.tool,trg),400); });
      trg.addEventListener('mouseup',   ()=>{ clearTimeout(timer); });
      trg.addEventListener('click',     ()=>{
        const name=trg.dataset.tool; state.currentTool=name;
        if(name==='pen') showColorAndHud();
      });
    });

    // È†ÖÁõÆÊ±∫ÂÆö
    $$('.dropdown .menuitem').forEach(b=>{
      b.addEventListener('click', ()=>{
        const group=b.closest('.dropdown').id.replace('menu-','');
        state.currentTool=group; state.subTool[group]=b.dataset.sub;
        if(icons[group] && b.dataset.icon) icons[group].src=b.dataset.icon;
        if(!pins[group]?.checked) hide(b.closest('.dropdown'));
        document.querySelector(`.tool-trigger[data-tool="${group}"]`)?.setAttribute('aria-expanded','false');
        if(group==='pen') showColorAndHud();
      });
    });

    // Â§ñÂÅ¥„ÇØ„É™„ÉÉ„ÇØ / Esc
    document.addEventListener('click', e=>{
      if(!e.target.closest('.dropdown, .tool-trigger, #color-panel, #opacity-hud')){ closeAll(); hideColorPanel(); hideHUD(true); }
    });
    document.addEventListener('keydown', e=>{ if(e.key==='Escape'){ closeAll(); hideColorPanel(); hideHUD(true); } });

    // ====== „Ç´„É©„Éº & ‰∏çÈÄèÊòéÂ∫¶ ======
    const colorPanel=$('#color-panel'), hud=$('#opacity-hud'), hudLabel=$('#opacity-label'), hudRange=$('#opacity-range'), hudPin=$('#opacity-pin');
    function showColorAndHud(){ positionColor(); show(colorPanel); positionHUD(); show(hud); resetHudTimer(); }
    function hideColorPanel(){ hide(colorPanel); }
    function positionColor(){ const st=$('#stationery').getBoundingClientRect(), parent=$('#canvas').getBoundingClientRect();
      colorPanel.style.left=(st.left - parent.left)+'px'; colorPanel.style.top=(st.bottom - parent.top + 10)+'px'; }
    function positionHUD(){ const r=colorPanel.getBoundingClientRect(), parent=$('#canvas').getBoundingClientRect();
      hud.style.left=(r.right - parent.left + 16)+'px'; hud.style.top=(r.top - parent.top + 8)+'px'; }
    function resetHudTimer(){ clearTimeout(state.timers.hud); state.timers.hud=setTimeout(()=>hideHUD(false),2000); }
    function hideHUD(force){ const pinned=hudPin.classList.contains('on'); if(force || !pinned){ hide(hud); hide(colorPanel); } }

    $$('#color-panel .swatch').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const act=btn.dataset.action;
        if(act==='add'){ /* Âæå„Åß„Ç´„É©„Éº„Éî„ÉÉ„Ç´„ÉºÊé•Á∂ö */ }
        else if(act==='eyedrop'){ /* Âæå„Åß„Çπ„Éù„Ç§„ÉàÊé•Á∂ö */ }
        else{ state.color = btn.dataset.color; /* ÊèèÁîªÂÅ¥„Å∏ÈÄöÁü•ÊÉ≥ÂÆö */ }
        resetHudTimer();
      });
    });
    hudRange.addEventListener('input', ()=>{ state.opacity=parseInt(hudRange.value,10); hudLabel.textContent=`${state.opacity} %`; resetHudTimer(); });
    hudPin.addEventListener('click', ()=>{ hudPin.classList.toggle('on'); hudPin.title = hudPin.classList.contains('on')?'Âõ∫ÂÆö‰∏≠':'Âõ∫ÂÆö'; });

    // ====== „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàÔºàMVPÔºâ ======
    document.addEventListener('keydown', e=>{
      if(e.target.closest('input, textarea, [contenteditable="true"]')) return;
      const k=e.key.toLowerCase();
      if(k==='v'){ state.currentTool='select'; state.subTool.select='select';  icons.select.src='/create_parts/object_btn/select.png'; }
      if(k==='a'){ state.currentTool='select'; state.subTool.select='direct';  icons.select.src='/create_parts/object_btn/direct_select.png'; }
      if(k==='m'){ state.currentTool='box';    state.subTool.box   ='rect';    icons.box.src='/create_parts/object_btn/square.png'; }
      if(k==='o'){ state.currentTool='box';    state.subTool.box   ='ellipse'; icons.box.src='/create_parts/object_btn/ellipse.png'; }
      if(k==='b'){ state.currentTool='pen';    state.subTool.pen   ='brush';   icons.pen.src='/create_parts/object_btn/brush.png'; showColorAndHud(); }
      if(k==='p'){ state.currentTool='pen';    state.subTool.pen   ='pencil';  icons.pen.src='/create_parts/object_btn/pencil.png'; showColorAndHud(); }
      if(k==='e'){ state.currentTool='pen';    state.subTool.pen   ='eraser';  icons.pen.src='/create_parts/object_btn/eraser.png'; }
      if(k==='c'){ if(colorPanel.classList.contains('hide')) showColorAndHud(); else { hideColorPanel(); hideHUD(true); } }
      if(k==='['){ hudRange.value=Math.max(0,parseInt(hudRange.value,10)-5); hudRange.dispatchEvent(new Event('input')); }
      if(k===']'){ hudRange.value=Math.min(100,parseInt(hudRange.value,10)+5); hudRange.dispatchEvent(new Event('input')); }
    });

    // ====== „Éû„Éç„Ç≠„É≥ÔºàÊó¢Â≠òÔºö„Éî„É≥„ÉÅ/„Éë„É≥Ôºâ ======
    (function(){
      const wrap=document.getElementById('man-zoom'), canvas=document.getElementById('canvas');
      let scale=1,targetScale=1,panX=0,targetPanX=0,panY=0,targetPanY=0; const MIN=0.5,MAX=4;
      const apply=()=>{ wrap.style.setProperty('--man-scale',scale); wrap.style.setProperty('--man-x',panX+'px'); wrap.style.setProperty('--man-y',panY+'px'); };
      let raf=null; function anim(){ scale+=(targetScale-scale)*0.2; panX+=(targetPanX-panX)*0.2; panY+=(targetPanY-panY)*0.2; apply();
        if(Math.abs(targetScale-scale)<0.0005 && Math.abs(targetPanX-panX)<0.1 && Math.abs(targetPanY-panY)<0.1){ cancelAnimationFrame(raf); raf=null; return; }
        raf=requestAnimationFrame(anim); } const tick=()=>{ if(!raf) raf=requestAnimationFrame(anim); };
      const setS=s=>{ targetScale=Math.min(MAX,Math.max(MIN,s)); tick(); }, addP=(dx,dy)=>{ targetPanX+=dx; targetPanY+=dy; tick(); };
      canvas.addEventListener('wheel', e=>{ if(e.ctrlKey){ e.preventDefault(); setS(targetScale*Math.exp(-e.deltaY*0.002)); } else { addP(-e.deltaX,-e.deltaY); } }, {passive:false});
      let gBase=1; addEventListener('gesturestart',()=>{ gBase=targetScale; },{passive:true}); addEventListener('gesturechange',e=>{ e.preventDefault(); setS(gBase*e.scale); },{passive:false});
      let t0=null, base=1; const dist=(a,b)=>Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY), mid=(a,b)=>({x:(a.clientX+b.clientX)/2,y:(a.clientY+b.clientY)/2});
      canvas.addEventListener('touchstart',e=>{ if(e.touches.length===2){ const [a,b]=e.touches; t0={d:dist(a,b),c:mid(a,b)}; base=targetScale; } },{passive:true});
      canvas.addEventListener('touchmove', e=>{ if(e.touches.length===2 && t0){ e.preventDefault(); const [a,b]=e.touches; const d=dist(a,b),c=mid(a,b); setS(base*(d/t0.d)); addP((c.x-t0.c.x),(c.y-t0.c.y)); } },{passive:false});
      canvas.addEventListener('touchend', ()=>{ t0=null; },{passive:true});
      let drag=false,mx=0,my=0; wrap.addEventListener('mousedown',e=>{ drag=true; mx=e.clientX; my=e.clientY; e.preventDefault(); });
      addEventListener('mousemove',e=>{ if(!drag) return; addP(e.clientX-mx,e.clientY-my); mx=e.clientX; my=e.clientY; });
      addEventListener('mouseup',()=>{ drag=false; });
      let last=0; canvas.addEventListener('click',e=>{ const now=Date.now(); if(now-last<300){ targetScale=1; targetPanX=0; targetPanY=0; tick(); } last=now; });
      apply();
    })();
  </script>
</body>
</html>
