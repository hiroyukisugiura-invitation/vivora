<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- Vivora Fashion Illustration 2025 — HTML＋JS -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vivora Fashion Illustration 2025</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div id="app-root">
    <!-- ================= Topbar ================= -->
    <header class="topbar" aria-label="global toolbar">
      <div class="topbar__left">
        <button id="next-step" class="ghost-btn" title="Next Step">Next Step ▶▶</button>
        <!-- contents button -->
        <nav class="contents-button" aria-label="contents">
          <img src="../../create_parts/contents_button/0_home.png"   alt="Home"   title="Home" />
          <img src="../../create_parts/contents_button/1_file.png"   alt="File"   title="File" />
          <img src="../../create_parts/contents_button/2_edit.png"   alt="Edit"   title="Edit" />
          <img src="../../create_parts/contents_button/3_view.png"   alt="View"   title="View" />
          <img src="../../create_parts/contents_button/4_window.png" alt="Window" title="Window" />
        </nav>
      </div>

      <div class="topbar__center">
        <h1 class="app-title">Vivora Fashion Illustration 2025</h1>
      </div>

      <div class="topbar__right">
        <!-- history tool -->
        <div class="history-tool" aria-label="history tool">
          <button class="tile" title="Undo">
            <img src="../../create_parts/create_button/undo.png" alt="Undo" />
          </button>
          <button class="tile" title="Redo">
            <img src="../../create_parts/create_button/redo.png" alt="Redo" />
          </button>
          <button class="tile" title="Reset">
            <img src="../../create_parts/create_button/reset.png" alt="Reset" />
          </button>
        </div>
      </div>
    </header>

    <!-- ================= Work Area ================= -->
    <main class="work">
      <div id="board-wrapper">
        <section id="board" aria-label="fixed artboard">
          <div id="canvas" aria-label="drawing canvas">
            <!-- マネキン -->
            <div id="stage" class="stage">
              <img id="mannequin" class="mannequin"
                   src="../../mannequin/mannequin_woman.png"
                   alt="mannequin" draggable="false" />
            </div>

            <!-- Stationery Tool -->
            <div id="stationery" class="stationery">
              <button class="st-btn" data-tool="pen" id="tool-pen" title="Pen">
                <img src="../../create_parts/design_button/pen.png" alt="Pen" />
              </button>
              <button class="st-btn" data-tool="brush" title="Brush">
                <img src="../../create_parts/design_button/brush.png" alt="Brush" />
              </button>
              <button class="st-btn" data-tool="eraser" title="Eraser">
                <img src="../../create_parts/design_button/eraser.png" alt="Eraser" />
              </button>
              <button class="st-btn" data-tool="picker" title="Color Picker">
                <img src="../../create_parts/design_button/colorpicker.png" alt="Color Picker" />
              </button>

              <!-- Pen サブパネル -->
              <div id="pen-panel" class="pen-panel" hidden>
                <div class="row">
                  <label>太さ</label>
                  <input id="pen-size" type="range" min="1" max="24" value="6" />
                  <span id="pen-size-val">6</span>
                </div>
                <div class="row">
                  <label>カラー</label>
                  <input id="pen-color" type="color" value="#111111" />
                </div>
              </div>
            </div>

            <!-- グリッド -->
            <div id="grid" class="grid" aria-hidden="true"></div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- ================= JS ================= -->
  <script>
    const $  = (sel, root=document) => root.querySelector(sel);

    // Penパネル
    (function(){
      const penBtn  = $('#tool-pen');
      const panel   = $('#pen-panel');
      const station = $('#stationery');
      const size    = $('#pen-size');
      const sizeVal = $('#pen-size-val');

      penBtn.addEventListener('mouseenter', () => {
        panel.hidden = false;
        requestAnimationFrame(() => panel.classList.add('open'));
      });
      station.addEventListener('mouseleave', () => {
        panel.classList.remove('open');
        panel.hidden = true;
      });
      size.addEventListener('input', () => { sizeVal.textContent = size.value; });
    })();

    // 固定ボード scale
    (function(){
      const wrapper = document.getElementById('board-wrapper');
      const board   = document.getElementById('board');
      const BW = 1440, BH = 900;
      function applyScale(){
        const W = wrapper.clientWidth;
        const H = wrapper.clientHeight;
        const scale = Math.min(W / BW, H / BH);
        board.style.transform = `translate(-50%, -50%) scale(${scale})`;
      }
      window.addEventListener('resize', applyScale);
      new ResizeObserver(applyScale).observe(wrapper);
      applyScale();
    })();

    // パン＆ズーム
    (function(){
      const stage = document.getElementById('stage');
      let scale = 1, tx = 0, ty = 0, dragging = false, px=0, py=0;

      function update(){
        stage.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
      }
      stage.addEventListener('pointerdown', (e) => {
        dragging = true;
        stage.setPointerCapture(e.pointerId);
        px = e.clientX; py = e.clientY;
      });
      stage.addEventListener('pointermove', (e) => {
        if(!dragging) return;
        const dx = e.clientX - px, dy = e.clientY - py;
        px = e.clientX; py = e.clientY;
        tx += dx; ty += dy;
        update();
      });
      stage.addEventListener('pointerup',   (e) => { dragging=false; stage.releasePointerCapture(e.pointerId); });
      stage.addEventListener('pointercancel', () => { dragging=false; });

      stage.addEventListener('wheel', (e) => {
        e.preventDefault();
        const delta  = -e.deltaY;
        const factor = Math.exp(delta * 0.0015);
        const rect = stage.getBoundingClientRect();
        const cx = e.clientX - rect.left;
        const cy = e.clientY - rect.top;
        const nx = (cx - tx) / scale;
        const ny = (cy - ty) / scale;
        scale = Math.min(5, Math.max(0.2, scale * factor));
        tx = cx - nx * scale;
        ty = cy - ny * scale;
        update();
      }, { passive:false });

      update();
    })();

    // グリッド ON/OFF
    (function(){
      const grid = document.getElementById('grid');
      window.addEventListener('keydown', (e) => {
        if(e.key.toLowerCase()==='g') grid.classList.toggle('show');
      });
    })();
  </script>
</body>
</html>
