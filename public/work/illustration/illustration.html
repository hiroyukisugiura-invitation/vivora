<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vivora Fashion Illustration 2025</title>
  <style>
    :root{
      --bg:#e9e2d9;            /* 2æšç›®ã®ã‚„ã‚„ãƒ™ãƒ¼ã‚¸ãƒ¥ */
      --panel:#f3ede6;         /* ã‚µã‚¤ãƒ‰/ã‚«ãƒ¼ãƒ‰ */
      --ink:#2a2a2a;
      --muted:#666;
      --line:#ddd4ca;
      --brand:#111;
      --btn:#f5f2ee;
      --btn-h:#ebe6df;
      --accent:#111;           /* ãƒœã‚¿ãƒ³æ /å¼·èª¿ */
      --radius:16px;
      --shadow:0 2px 10px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink); background:var(--bg);
      font:16px/1.4 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif;
      letter-spacing:.02em;
    }

    /* ====== ä¸Šéƒ¨ãƒãƒ¼ ====== */
    header{
      display:grid;
      grid-template-columns: 320px 1fr 220px; /* å·¦: ã‚¿ãƒ– / ä¸­å¤®: ãƒ„ãƒ¼ãƒ« / å³: Next */
      align-items:center;
      gap:12px;
      padding:14px 18px;
    }
    .product-title{font-size:18px;font-weight:600;opacity:.85}

    .tabs{
      display:flex; gap:10px; align-items:center;
    }
    .tab{
      background:#fff; border:1px solid var(--line); border-radius:10px; padding:8px 14px; cursor:pointer;
      box-shadow:var(--shadow); min-width:82px; text-align:center; font-weight:600;
    }
    .tab.is-active{ background:var(--brand); color:#fff; border-color:var(--brand)}

    .toolbar{ display:flex; gap:10px; justify-content:center; }
    .icon-btn{
      width:34px; height:34px; display:grid; place-items:center; border:1px solid var(--line);
      border-radius:8px; background:#fff; cursor:pointer; box-shadow:var(--shadow);
      transition:transform .05s ease; user-select:none; padding:0; overflow:hidden;
    }
    .icon-btn img{ width:20px; height:20px; display:block }
    .icon-btn:active{ transform:translateY(1px) }
    .icon-btn:active{ transform:translateY(1px) }

    .next-wrap{ display:flex; justify-content:flex-end; }
    .next{
      background:#fff; border:1px solid var(--line); border-radius:12px; padding:10px 16px; font-weight:700;
      box-shadow:var(--shadow); cursor:pointer; min-width:130px; text-align:center;
    }

    /* ====== ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ====== */
    .page{
      display:grid; grid-template-columns: 1fr 320px; gap:18px; padding:0 18px 22px;
    }

    .stage{
      background:#fff; border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:18px; min-height:72vh; display:flex; align-items:center; justify-content:center;
    }

    /* ã‚­ãƒ£ãƒ³ãƒã‚¹é ˜åŸŸ */
    .canvas{
      width:100%; height:100%; display:flex; align-items:center; justify-content:center;
    }
    .canvas-inner{ width:min(900px, 90%); aspect-ratio: 3/4; background:#fff; border:1px solid var(--line);
      border-radius:12px; display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden;
    }
    #mannequin{
      max-width:72%; height:auto; opacity:1; transform-origin:center bottom; image-rendering:auto; filter:drop-shadow(0 0 0 rgba(0,0,0,0));
      transition:opacity .15s ease, transform .15s ease; position:relative; z-index:1;
    }

    /* ====== ã‚µã‚¤ãƒ‰ãƒãƒ¼ ====== */
    aside{
      display:flex; flex-direction:column; gap:16px;
    }

    .card{
      background:var(--panel); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:14px; 
    }
    .card h3{ margin:0 0 10px; font-size:14px; font-weight:700; opacity:.8 }

    /* Pose ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ2æšç›®ã®ä¸Šéƒ¨ã®+ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰ */
    .pose-row{ display:grid; grid-template-columns: 28px 1fr 28px; align-items:center; gap:8px; }
    .pose-track{ display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; }
    .pose-slot{
      height:60px; background:#fff; border:1px dashed #cfc5b9; border-radius:12px; display:grid; place-items:center; color:#b8afa4;
      font-weight:700; box-shadow:var(--shadow); cursor:default;
    }
    .pose-arrow{ width:28px; height:60px; display:grid; place-items:center; color:#9a9085; }

    /* Stationery ã‚°ãƒªãƒƒãƒ‰ */
    .grid{ display:grid; grid-template-columns: repeat(5, 1fr); gap:10px; }
    .tool{
      height:38px; background:#fff; border:1px solid var(--line); border-radius:10px; display:grid; place-items:center; box-shadow:var(--shadow);
      cursor:pointer; font-size:13px; font-weight:700; color:var(--muted); padding:0; overflow:hidden;
    }
    .tool img{ width:18px; height:18px; display:block }
    .tool.active{ border-color:#6b5f55; box-shadow:0 0 0 2px rgba(0,0,0,.04) inset }

    /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */
    .slider-row{ display:grid; grid-template-columns: 34px 1fr 38px; align-items:center; gap:12px; }
    .slider-row input[type="range"]{ width:100% }
    .chip{ border:1px solid var(--line); background:#fff; padding:6px 8px; border-radius:8px; text-align:center; min-width:48px; }

    /* ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ */
    .colors{ display:grid; grid-template-columns: repeat(8, 1fr); gap:10px; }
    .swatch{ width:34px; height:34px; border-radius:8px; border:1px solid rgba(0,0,0,.08); box-shadow:var(--shadow); cursor:pointer; }
    .color-tools{ display:flex; gap:8px; margin-top:10px; }
    .mini{ width:32px; height:32px; border:1px solid var(--line); background:#fff; border-radius:8px; display:grid; place-items:center; box-shadow:var(--shadow); cursor:pointer; }

    /* æç”»ãƒ¬ã‚¤ãƒ¤ãƒ¼ */
    #drawLayer{ position:absolute; inset:0; z-index:2; touch-action:none; }
    .canvas-inner{ position:relative }

    /* ãƒ˜ãƒ«ãƒ—æ³¨è¨˜ */
    .note{ font-size:12px; color:#7a7268; margin-top:8px }

    /* å°ã•ã‚ç”»é¢é…æ…®ï¼ˆiPadæ¨ªå‘ãæƒ³å®šã®æœ€å°èª¿æ•´ï¼‰ */
    @media (max-width: 1100px){
      header{ grid-template-columns: 1fr 1fr 160px }
      .page{ grid-template-columns: 1fr 300px }
      .colors{ grid-template-columns: repeat(6, 1fr) }
      .canvas-inner{ width:95% }
    }
      .page{ grid-template-columns: 1fr 300px }
      .colors{ grid-template-columns: repeat(6, 1fr) }
      .canvas-inner{ width:95% }
    }
  </style>
</head>
<body>
  <header>
    <div class="tabs">
      <div class="product-title">Vivora Fashion Illustration 2025</div>
      <button class="tab is-active" data-target="woman">Woman</button>
      <button class="tab" data-target="man">Man</button>
      <button class="tab" data-target="kids">Kids</button>
    </div>

    <nav class="toolbar" aria-label="canvas tools">
      <button class="icon-btn" title="Undo" data-icon="undo"></button>
      <button class="icon-btn" title="Redo" data-icon="redo"></button>
      <button class="icon-btn" title="Reset View" data-icon="reset"></button>
      <button class="icon-btn" title="Save" data-icon="save"></button>
      <button class="icon-btn" title="Upload" data-icon="upload"></button>
      <button class="icon-btn" title="Grid" data-icon="grid"></button>
      <button class="icon-btn" title="Pen" data-icon="pen"></button>
      <button class="icon-btn" title="Eraser" data-icon="eraser"></button>
      <button class="icon-btn" title="Select" data-icon="select"></button>
      <button class="icon-btn" title="Move" data-icon="move"></button>
      <button class="icon-btn" title="Camera" data-icon="camera"></button>
      <button class="icon-btn" title="Help" data-icon="help"></button>
    </nav>

    <div class="next-wrap">
      <button class="next" id="nextStep">Next Step â–¸â–¸</button>
    </div>
  </header>

  <main class="page">
    <!-- ====== å·¦ï¼šã‚¹ãƒ†ãƒ¼ã‚¸ ====== -->
    <section class="stage">
      <div class="canvas">
        <div class="canvas-inner">
          <!-- æ—¢å­˜ã®ãƒªãƒã‚¸ãƒˆãƒªè³‡ç”£ã«åˆã‚ã›ã¦ id=\"mannequin\" ã¯ç¶­æŒ -->
          <img id="mannequin" class="mannequin-base" src=\"./mannequin/mannequin_woman.png\" alt="Woman mannequin" />
          <canvas id="drawLayer"></canvas>
        </div>
      </div>
    </section>

    <!-- ====== å³ï¼šã‚µã‚¤ãƒ‰ãƒãƒ¼ ====== -->
    <aside>
      <!-- Pose ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è¡Œ -->
      <div class="card">
        <div class="pose-row">
          <div class="pose-arrow">â€¹</div>
          <div class="pose-track">
            <div class="pose-slot">ï¼‹</div>
            <div class="pose-slot">ï¼‹</div>
            <div class="pose-slot">ï¼‹</div>
            <div class="pose-slot">ï¼‹</div>
          </div>
          <div class="pose-arrow">â€º</div>
        </div>
      </div>

      <!-- Stationery -->
      <div class="card">
        <h3>Stationery</h3>
        <div class="grid" style="margin-bottom:10px">
          <button class="tool" data-tool="triangle" title="Triangle"></button>
          <button class="tool" data-tool="arrow" title="Arrow"></button>
          <button class="tool" data-tool="text" title="Text"></button>
          <button class="tool" data-tool="stamp" title="Stamp"></button>
          <button class="tool" data-tool="clock" title="Clock"></button>
          <button class="tool" data-tool="pen" title="Pen"></button>
          <button class="tool" data-tool="brush" title="Brush"></button>
          <button class="tool" data-tool="eraser" title="Eraser"></button>
          <button class="tool" data-tool="rhombus" title="Rhombus"></button>
          <button class="tool" data-tool="rotate" title="Rotate"></button>
          <button class="tool" data-tool="percent" title="%"></button>
          <button class="tool" data-tool="align" title="Align"></button>
          <button class="tool" data-tool="camera" title="Camera"></button>
          <button class="tool" data-tool="crop" title="Crop"></button>
          <button class="tool" data-tool="resize" title="Resize"></button>
        </div>
        <div class="note">â€» UIã¯ãƒ€ãƒŸãƒ¼ã§ã™ã€‚å¿…è¦ã«å¿œã˜ã¦æ©Ÿèƒ½ã‚’å‰²ã‚Šå½“ã¦å¯èƒ½ã€‚</div>â–  ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠæ™‚ã¯è©²å½“ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã®ã¿åæ˜ ï¼ˆä»Šã¯ãƒ™ãƒ¼ã‚¹ã«é©ç”¨ï¼‰</div>
      </div>

      <!-- Color -->
      <div class="card">
        <h3>Color</h3>
        <div class="colors" id="palette"></div>
        <div class="color-tools">
          <button class="mini" id="addColor">ï¼‹</button>
          <button class="mini" id="pipette" title="Eyedropper">ğŸ–‰</button>
        </div>
      </div>
    </aside>
  </main>

  <script>
    // ====== æœ€ä½é™ã®å‹•ä½œï¼ˆã‚ºãƒ¼ãƒ ãƒ»ä¸é€æ˜åº¦ãƒ»ã‚«ãƒ©ãƒ¼ãƒ»æç”»ãƒ»æ›¸ãå‡ºã—ãƒ»ã‚¿ãƒ–åˆ‡æ›¿ï¼‰ ======
    const mannequin = document.getElementById('mannequin');
    const draw = document.getElementById('drawLayer');
    const ctx = draw.getContext('2d');
    const inner = document.querySelector('.canvas-inner');

    // -------- Canvas ã‚µã‚¤ã‚ºèª¿æ•´ --------
    function fitCanvas(){
      const r = inner.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      draw.width = Math.floor(r.width * dpr);
      draw.height = Math.floor(r.height * dpr);
      draw.style.width = r.width + 'px';
      draw.style.height = r.height + 'px';
      ctx.setTransform(dpr,0,0,dpr,0,0); // åº§æ¨™ç³»ã‚’CSSãƒ”ã‚¯ã‚»ãƒ«ã«
    }
    fitCanvas();
    window.addEventListener('resize', fitCanvas);

    // -------- Zoom --------
    const zr = document.getElementById('zoomRange');
    const zl = document.getElementById('zoomLabel');
    const zreset = document.getElementById('zoomReset');
    function applyZoom(v){ zl.textContent = v + '%'; mannequin.style.transform = `scale(${v/100})`; }
    applyZoom(zr.value);
    zr.addEventListener('input', e=> applyZoom(e.target.value));
    zreset.addEventListener('click', ()=>{ zr.value = 72; applyZoom(72); });

    // -------- Opacity --------
    const orng = document.getElementById('opaRange');
    const olbl = document.getElementById('opaLabel');
    const oreset = document.getElementById('opaReset');
    function applyOpacity(v){ olbl.textContent = v + '%'; mannequin.style.opacity = v/100; }
    applyOpacity(orng.value);
    orng.addEventListener('input', e=> applyOpacity(e.target.value));
    oreset.addEventListener('click', ()=>{ orng.value = 100; applyOpacity(100); });

    // -------- Paletteï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ16è‰² + è¿½åŠ ï¼‰ --------
    const preset = [
      '#ffffff','#e3e6e8','#c9cfd3','#9aa4a8','#f7d46a','#ffd24d','#ffb300','#f3a6ac',
      '#e74c3c','#e67e22','#2ecc71','#27ae60','#3498db','#1f6feb','#8e44ad','#2c3e50'
    ];
    const pal = document.getElementById('palette');
    let currentColor = '#1f6feb';
    function renderPalette(){
      pal.innerHTML = '';
      preset.forEach((c)=>{
        const b = document.createElement('button');
        b.className = 'swatch'; b.style.background = c; b.title = c;
        b.addEventListener('click', ()=>{
          currentColor = c;
          document.documentElement.style.setProperty('--accent', c);
        });
        pal.appendChild(b);
      })
    }
    renderPalette();

    document.getElementById('addColor').addEventListener('click', ()=>{
      const c = prompt('è‰²ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ› (ä¾‹: #ff6600)');
      if(!c) return; const ok = /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(c.trim());
      if(ok){ preset.push(c.trim()); renderPalette(); }
      else alert('ç„¡åŠ¹ãªã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã§ã™');
    });

    // -------- æç”»ï¼ˆãƒšãƒ³/æ¶ˆã—ã‚´ãƒ ï¼‰ --------
    let drawing = false;
    let tool = 'pen';
    let last = {x:0,y:0};
    const penBtn = document.querySelector('.tool[title="Pen"]');
    const eraserBtn = document.querySelector('.tool[title="Eraser"]');
    const cameraBtn = document.querySelector('.tool[title="Camera"]');

    function setTool(name){
      tool = name;
      [penBtn,eraserBtn].forEach(b=> b.classList.remove('active'));
      if(name==='pen') penBtn.classList.add('active');
      if(name==='eraser') eraserBtn.classList.add('active');
      draw.style.cursor = name==='eraser' ? 'cell' : 'crosshair';
    }
    setTool('pen');

    function posFromEvent(e){
      const rect = draw.getBoundingClientRect();
      if(e.touches){ e = e.touches[0]; }
      return { x: e.clientX - rect.left, y: e.clientY - rect.top };
    }

    function lineTo(p){
      ctx.lineJoin = 'round';
      ctx.lineCap = 'round';
      ctx.lineWidth = tool==='eraser' ? 18 : 3.5;
      if(tool==='eraser') ctx.globalCompositeOperation = 'destination-out';
      else { ctx.globalCompositeOperation = 'source-over'; ctx.strokeStyle = currentColor; }
      ctx.beginPath(); ctx.moveTo(last.x,last.y); ctx.lineTo(p.x,p.y); ctx.stroke();
      last = p;
    }

    function start(e){ drawing = true; last = posFromEvent(e); }
    function move(e){ if(!drawing) return; lineTo(posFromEvent(e)); }
    function end(){ drawing = false; }

    draw.addEventListener('mousedown', start);
    draw.addEventListener('mousemove', move);
    window.addEventListener('mouseup', end);
    draw.addEventListener('touchstart', start, {passive:false});
    draw.addEventListener('touchmove', (e)=>{ e.preventDefault(); move(e); }, {passive:false});
    window.addEventListener('touchend', end);

    penBtn.addEventListener('click', ()=> setTool('pen'));
    eraserBtn.addEventListener('click', ()=> setTool('eraser'));

    // -------- æ›¸ãå‡ºã—ï¼ˆPNGï¼‰ --------
    cameraBtn.addEventListener('click', async ()=>{
      // å‡ºåŠ›ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ç”¨æ„ã—ã€ãƒãƒã‚­ãƒ³ + æç”»ã‚’åˆæˆ
      const r = inner.getBoundingClientRect();
      const out = document.createElement('canvas');
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      out.width = Math.floor(r.width * dpr);
      out.height = Math.floor(r.height * dpr);
      const octx = out.getContext('2d');
      octx.setTransform(dpr,0,0,dpr,0,0);

      // èƒŒæ™¯ï¼ˆç™½ï¼‰
      octx.fillStyle = '#fff';
      octx.fillRect(0,0,r.width,r.height);

      // ãƒãƒã‚­ãƒ³ï¼ˆ72%å¹…ã§ä¸­å¤®é…ç½®ï¼‰
      await mannequin.decode?.();
      const iw = mannequin.naturalWidth || 1000;
      const ih = mannequin.naturalHeight || 1500;
      const drawW = r.width * 0.72;
      const drawH = drawW * (ih/iw);
      const dx = (r.width - drawW)/2;
      const dy = (r.height - drawH)/2;
      octx.globalAlpha = parseFloat(getComputedStyle(mannequin).opacity) || 1;
      octx.drawImage(mannequin, dx, dy, drawW, drawH);
      octx.globalAlpha = 1;

      // æ‰‹æããƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’åˆæˆ
      octx.drawImage(draw, 0, 0, r.width, r.height);

      const url = out.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url; a.download = 'vivora_export.png';
      document.body.appendChild(a); a.click(); a.remove();
    });

    // -------- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆï¼ˆãƒãƒã‚­ãƒ³ç”»åƒå¤‰æ›´ï¼‰ --------
    const mannequinSrc = {
      woman: './mannequin/mannequin_woman.png',
      man: './mannequin/mannequin_man.png',
      kids: './mannequin/mannequin_kids.png'
    };

    // -------- PNGã‚¢ã‚¤ã‚³ãƒ³é©ç”¨ --------
    const ICON_BASE = './icons'; // â€»å¿…è¦ãªã‚‰ãƒ‘ã‚¹å¤‰æ›´å¯ï¼ˆä¾‹: ./work/illustration/iconsï¼‰
    const ICONS = {
      undo: ICON_BASE + '/undo.png',
      redo: ICON_BASE + '/redo.png',
      reset: ICON_BASE + '/reset.png',
      save: ICON_BASE + '/save.png',
      upload: ICON_BASE + '/upload.png',
      grid: ICON_BASE + '/grid.png',
      pen: ICON_BASE + '/pen.png',
      eraser: ICON_BASE + '/eraser.png',
      select: ICON_BASE + '/select.png',
      move: ICON_BASE + '/move.png',
      camera: ICON_BASE + '/camera.png',
      help: ICON_BASE + '/help.png'
    };
    const STATIONERY_ICONS = {
      triangle: ICON_BASE + '/triangle.png',
      arrow: ICON_BASE + '/arrow.png',
      text: ICON_BASE + '/text.png',
      stamp: ICON_BASE + '/stamp.png',
      clock: ICON_BASE + '/clock.png',
      pen: ICON_BASE + '/pen.png',
      brush: ICON_BASE + '/brush.png',
      eraser: ICON_BASE + '/eraser.png',
      rhombus: ICON_BASE + '/rhombus.png',
      rotate: ICON_BASE + '/rotate.png',
      percent: ICON_BASE + '/percent.png',
      align: ICON_BASE + '/align.png',
      camera: ICON_BASE + '/camera.png',
      crop: ICON_BASE + '/crop.png',
      resize: ICON_BASE + '/resize.png'
    };

    // ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã«ç”»åƒã‚’å·®ã—è¾¼ã‚€
    document.querySelectorAll('.icon-btn').forEach(b=>{
      const key = b.dataset.icon; const src = ICONS[key];
      if(src){ const img = new Image(); img.src = src; img.alt = key; b.appendChild(img); }
      else { b.textContent = 'Â·'; }
    });
    // ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒŠãƒªãƒ¼ã«ç”»åƒã‚’å·®ã—è¾¼ã‚€
    document.querySelectorAll('.tool').forEach(b=>{
      const key = b.dataset.tool; const src = STATIONERY_ICONS[key];
      if(src){ const img = new Image(); img.src = src; img.alt = key; b.appendChild(img); }
    });

    document.querySelectorAll('.tab').forEach(btn=>{.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('is-active'));
        btn.classList.add('is-active');
        const key = btn.dataset.target;
        if(mannequinSrc[key]) mannequin.src = mannequinSrc[key];
      })
    });
  </script>
</body>
</html>
