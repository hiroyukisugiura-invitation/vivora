/* ===================================================
   Vivora Fashion Illustration 2025 — 固定UI（1280×800）
   - Topbar：左=Next+contents（枠なし）/ 中央=Title / 右=History
   - Stationery：2枚目の順番で8アイコン
   =================================================== */
:root{
  --bg:#e9e1d7;
  --panel:#ffffff;
  --line:#d8d0c7;
  --text:#2a2a2a;

  --board-w:1280px;
  --board-h:800px;
  --r:12px;
  --shadow:0 2px 8px rgba(0,0,0,.08);

  --icon:22px;
  --gap:12px;
  --content-icon:28px;
}

*{ box-sizing:border-box }
html,body{ height:100% }
body{
  margin:0; background:var(--bg); color:var(--text);
  font-family:"Helvetica Neue", Arial, system-ui, sans-serif;
  overflow:hidden;
}

.app{
  width:100vw; height:100vh;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
}

/* ===== Topbar（canvasの外） ===== */
.topbar{
  width:var(--board-w);
  height:72px;
  display:grid;
  grid-template-columns: 1fr auto 1fr; /* 左 / 中央 / 右 */
  align-items:center;
  margin-bottom:10px;
  position:relative;
}

.topbar-left{
  display:flex; align-items:center; gap:14px; justify-self:start;
}

/* Next Step：アイコン2個ぶんの横幅 */
.ghost-btn{
  appearance:none; border:none; background:#f5f0ea;
  color:#333; font-size:14px; padding:6px 10px;
  border-radius:10px; box-shadow: inset 0 0 0 1px var(--line);
  cursor:pointer;
  min-width: calc((2 * var(--content-icon)) + 12px); /* 2アイコン + gap相当 */
  text-align:center;
}

/* contents：枠なしアイコンだけ */
.contents-button{ display:flex; gap:12px; align-items:center; }
.contents-button img{ width:var(--content-icon); height:var(--content-icon); display:block; }

.page-title{
  margin:0; font-size:18px; font-weight:500; letter-spacing:.2px;
  justify-self:center;
}

.history-tool{ display:flex; gap:14px; align-items:center; justify-self:end; }
.history-tool img{ width:22px; height:22px; display:block; }

/* ===== Board（canvas本体） ===== */
.board{
  position:relative;
  width:var(--board-w);
  height:var(--board-h);
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:var(--r);
  box-shadow:var(--shadow);
  overflow:hidden;
}

/* Canvas */
.canvas-wrapper{
  position:absolute; top:18px; left:18px;
  width:calc(100% - 36px); height:calc(100% - 36px);
  background:transparent; border:none; border-radius:10px;
  overflow:visible;
}

/* Stationery（canvas内 右上） */
.stationery-toolbar{
  position:absolute; top:10px; right:10px;
  display:flex; gap:var(--gap); align-items:center; z-index:3;
}
.stationery-toolbar img{
  width:var(--icon); height:var(--icon);
  user-select:none; -webkit-user-drag:none; display:block;
}

/* Mannequin（中央） */
#mannequin{
  position:absolute; top:50%; left:50%;
  transform:translate(-50%, -50%);
  height:85%; pointer-events:none; z-index:1;
}
/* ============ 右端そろえ用トークン ============ */
:root{
  --right-edge: 28px;   /* 右端の基準ライン（必要なら数pxずつ調整） */
}

/* ============ タイトル（左寄せ固定） ============ */
/* タイトル要素に .app-title が付いていない場合は、.topbar h1 などに置き換えてOK */
.topbar .app-title{
  margin-left: 24px;
  text-align: left;
  line-height: 1;
}

/* もし .topbar が中央寄せのままなら左寄せへ */
.topbar{
  display: flex;
  align-items: center;
  justify-content: flex-start; /* 中央寄せ→左寄せ */
}

/* ============ history tool を右端にスナップ ============ */
/* ここでは .history-tools がhistoryアイコン群のラッパと想定。
   クラス名が違う場合は該当ラッパのクラスに置き換えてください。 */
.topbar .history-tools{
  position: absolute;         /* 親(.topbar)を relative にしておくと綺麗に効きます */
  right: var(--right-edge);   /* ← stationery と同じ基準ライン */
  top: 60px;                  /* 上下位置は画面に合わせて微調整（例） */
}

/* ============ stationery tool の右端ライン統一 ============ */
/* 右側の白いツールボックス（stationery）全体のラッパ想定 */
.canvas .stationery-tools{
  position: absolute;
  right: var(--right-edge);   /* ← history と同じ値でピタッと揃う */
  /* 既存 top/bottom がある場合はそのままでOK */
}

/* もし .topbar が absolute 子要素の基準になっていない場合はこれを付与 */
.topbar{ position: relative; }
/* =========================
   Vivora Illustration – quick fix
   HTMLは触らずに整列＆サイズ調整
   ========================= */

/* 右端/余白の共通トークン（ここだけ調整で全体が揃う） */
:root{
  --edge: 28px;      /* 右端の基準ライン（25–36pxで微調整可） */
  --gap: 12px;       /* ツール間のすき間 */
  --title-left: 24px;/* タイトルの左マージン */
}

/* ---------- Topbar: タイトル左寄せ & 右端の整列 ---------- */
.topbar{
  position: relative;
  display: flex;
  align-items: center;
  gap: var(--gap);
  padding-right: var(--edge);   /* 右端の基準をcanvas内ツールと一致させる */
}

/* タイトル（要素名が h1 でなければ .topbar の中の見出し/タイトル要素に合わせて効きます） */
.topbar h1,
.topbar .app-title{
  order: 1;                /* 左寄せ側の自然な位置へ */
  margin-left: var(--title-left);
  text-align: left;
  white-space: nowrap;
}

/* 左側のツール群（Next Stepやcontentsボタン群）は先頭に来る想定 */
.topbar > *:first-child{ order: 0; }

/* 右側（history tool 群）を一番右へ押し出す。
   ラッパのクラス名が不明でも最後の子を右寄せにできる安全策 */
.topbar > *:last-child{
  margin-left: auto;
}

/* history tool のアイコン間隔を少し詰める（任意） */
.topbar > *:last-child img,
.topbar > *:last-child svg{
  margin-left: var(--gap);
}

/* ---------- Stationery と history の右端ラインを合わせる ---------- */
/* 右側のステーショナリー群のラッパに当たりそうな候補を包括（クラス名違いでも効くよう複数記述） */
.stationery-tools,
.tools-right,
.right-tools,
.canvas .toolbox-right,
.canvas .tools{
  position: absolute;
  right: var(--edge);   /* ← topbarのpadding-right と同じにして“同一ライン” */
}

/* ---------- マネキン：初回サイズを拡大（2枚目相当） ---------- */
/* 画像ID/クラスの両対応。値は画面に依存せず“ちょうど良い”範囲で安定するよう clamp に */
#mannequin,
.mannequin-base{
  display: block;
  margin: 0 auto;                   /* 常に中央に見えるよう保険 */
  height: clamp(420px, 54vh, 560px);/* 目安：2枚目くらいのサイズ */
  width: auto;
  object-fit: contain;              /* 画像の比率保持 */
  image-rendering: auto;
}

/* キャンバス内で上下が窮屈に感じる場合は余白を少し加える（任意） */
.canvas,
.board,
.workspace{
  /* 既存指定があればそれを優先。足りない場合の保険だけ効くよう弱めに書く */
  padding-bottom: max(env(safe-area-inset-bottom, 0px), 8px);
}
/* =========================
   Topbar 2段レイアウト
   HTML変更なしで配置入れ替え
   ========================= */
:root{
  --edge: 28px;        /* 右端ライン（history/ステーショナリと共通） */
  --gap: 12px;
  --title-left: 24px;  /* タイトルの左寄せ量 */
}

/* Topbar を2段のグリッドにする */
.topbar{
  position: relative;
  display: grid;
  grid-template-columns: 1fr auto;  /* 左列=NextStep/contents、右列=history */
  grid-template-rows: auto auto;    /* 1段目=タイトル、2段目=ツール列 */
  align-items: center;
  column-gap: var(--gap);
  padding-right: var(--edge);       /* 右端ラインを統一 */
}

/* 1段目：タイトルを左に */
.topbar h1,
.topbar .app-title{
  grid-column: 1 / 2;   /* 左列 */
  grid-row: 1;          /* 1段目 */
  margin-left: var(--title-left);
  white-space: nowrap;
  text-align: left;
}

/* 2段目：左側（NextStep と contents を同じセルに収める） */
#next-step,
.topbar .contents-button{
  grid-column: 1 / 2;   /* 左列の同じセル */
  grid-row: 2;          /* 2段目 */
  align-self: center;
}
#next-step{ margin-left: var(--title-left); }   /* タイトルと左端を合わせる */
.topbar .contents-button{ margin-left: var(--gap); }

/* 2段目：右側（history 群を右端へ） */
.topbar .history-tools,
.topbar .topbar-right,
.topbar > *:last-child{         /* クラス名が異なる場合の保険 */
  grid-column: 2 / 3;           /* 右列 */
  grid-row: 2;                  /* 2段目 */
  justify-self: end;
}
.topbar .history-tools img,
.topbar .history-tools svg{ margin-left: var(--gap); }

/* 右側のステーショナリ群と右端ラインを合わせる（既に指定があればそのままでOK） */
.stationery-tools,
.tools-right,
.canvas .toolbox-right{
  right: var(--edge);
}
/* ============ Physical-like Grid ============ */
/* 1マス=約4.52mm → 17px を初期値に。端末差は --grid-tune で±調整 */
:root{
  --grid: 17px;       /* 1マス */
  --grid-tune: 0px;   /* 0〜0.5px で微調整。例: 0.25px */
  --G: calc(var(--grid) + var(--grid-tune)); /* 実効グリッド */
  --edge: calc(2 * var(--G)); /* 右端の基準（2マス余白） */
}

/* Topbar全体をグリッド基準でレイアウト（HTML変更なし） */
.topbar{
  position: relative;
  height: calc(10 * var(--G));      /* 方眼紙で上段の高さ ≒ 10マス */
  display: block;                    /* 2段構成は絶対配置で作る */
  padding: 0;                        /* 余白はグリッドで管理 */
}

/* 1段目：タイトル（左から2マス、上から3マス） */
.topbar h1,
.topbar .app-title{
  position: absolute;
  left:  calc(2 * var(--G));
  top:   calc(3 * var(--G));
  margin: 0;
  white-space: nowrap;
  line-height: 1.1;
}

/* 2段目：Next Step と contents 群（左から2マス、上から8マス） */
#next-step{
  position: absolute;
  left: calc(2 * var(--G));
  top:  calc(8 * var(--G));
}
.topbar .contents-button{
  position: absolute;
  left: calc(8 * var(--G));         /* NextStepの右に並べる：余白6マス */
  top:  calc(8 * var(--G));
}

/* 2段目：historyツール群（右から2マス、上から8マス） */
.topbar .history-tools,
.topbar .topbar-right,
.topbar > *:last-child{             /* クラス差異の保険 */
  position: absolute !important;
  right: calc(2 * var(--G));
  top:   calc(8 * var(--G));
  display: inline-flex;
  gap: calc(0.7 * var(--G));        /* アイコン間隔 ≒ 0.7マス */
}

/* キャンバス内のステーショナリ群の右端をhistoryと同一ラインに */
.stationery-tools,
.tools-right,
.canvas .toolbox-right{
  right: calc(2 * var(--G));
}

/* マネキン初期サイズ（2枚目スクショ相当） */
#mannequin,
.mannequin-base{
  display: block;
  margin: 0 auto;
  height: clamp(440px, 56vh, 560px); /* 端末差を吸収しつつ大きめに */
  width: auto;
  object-fit: contain;
}

/* ボードの角丸とトップバーの境界がズレる場合の保険 */
.board, .canvas, .workspace{
  margin-top: calc(0.8 * var(--G));   /* 角丸の接触を回避（必要時） */
}
/* =========================
   Topbar: 理想バランス（方眼1マス基準）
   HTMLは触らない
   ========================= */
:root{
  /* 1マス ≒ 4.52mm。端末差は --grid-tune で微調整 */
  --grid: 17px;
  --grid-tune: 0px;
  --G: calc(var(--grid) + var(--grid-tune));

  /* ─ 配置パラメータ（必要ならここだけ触ればOK） ─ */
  --title-left-g: 2;    /* タイトルの左マージン（マス）       → 2マス */
  --title-row:    2.9;  /* タイトルの縦位置（マス）           → 2.9マス */

  --next-left-g:      2;    /* Next Step の左位置（マス）       → 2マス */
  --toolbar-row:      7.20; /* Next Step/ツールの縦位置（マス） → 7.20マス */
  --contents-left-g:  9.8;  /* ツール群の左位置（マス）         → 9.8マス */

  --right-edge-g: 2;        /* 右端ツールの内側余白（マス）     → 2マス */
}

/* Topbar の高さをグリッドで定義（上段=タイトル、下段=ツール） */
.topbar{
  position: relative;
  display: block;
  height: calc(11 * var(--G));   /* タイトルとツールが綺麗に収まる高さ */
  padding: 0;
}

/* タイトル：左から2マス、上から2.9マス */
.topbar h1,
.topbar .app-title{
  position: absolute;
  left: calc(var(--title-left-g) * var(--G));
  top:  calc(var(--title-row) * var(--G));
  margin: 0;
  white-space: nowrap;
  line-height: 1.1;
}

/* Next Step：左から2マス、上から7.2マス（理想スクショのライン） */
#next-step{
  position: absolute;
  left: calc(var(--next-left-g) * var(--G));
  top:  calc(var(--toolbar-row) * var(--G));
  line-height: 1;
}

/* ツール群（Home〜Dk）：NextStepの右に同じ高さで並べる */
.topbar .contents-button{
  position: absolute;
  left: calc(var(--contents-left-g) * var(--G)); /* ← ここで横位置だけ調整 */
  top:  calc(var(--toolbar-row) * var(--G));
  display: inline-flex;
  align-items: center;
  gap: calc(0.7 * var(--G)); /* アイコン間隔（必要に応じて 0.6〜0.8） */
}

/* 右上 history 群の右端ラインはステーショナリと同一（既存と統一） */
.topbar .history-tools,
.topbar .topbar-right,
.topbar > *:last-child{
  position: absolute !important;
  right: calc(var(--right-edge-g) * var(--G));
  top:   calc(var(--toolbar-row) * var(--G));
  display: inline-flex;
  gap: calc(0.7 * var(--G));
}

/* ステーショナリ右端も同じラインに（保険） */
.stationery-tools,
.tools-right,
.canvas .toolbox-right{
  right: calc(var(--right-edge-g) * var(--G));
}
/* =========================
   Canvas内ツールのアイコンサイズを
   上部ツール群（historyと同じ）に揃える
   ========================= */

/* 上部ツールと同じ基準サイズに */
.canvas .toolbox-right img,
.canvas .toolbox-right svg,
.stationery-tools img,
.stationery-tools svg{
  width: 28px;   /* historyと同じ大きさに */
  height: 28px;  /* 値は必要に応じて28〜30pxで調整可 */
  object-fit: contain;
}

/* アイコンを均等に並べる */
.canvas .toolbox-right,
.stationery-tools{
  display: flex;
  flex-direction: column;
  gap: 12px;   /* アイコン間隔（historyに合わせるなら10〜12px） */
  align-items: center;
}
