// app.js
// ================================
// Vivora Illustration — ステージ自動フィット＆基本フック
// ================================

// ■ ステージを画面にフィットさせる（イラレ風：固定寸法をscaleで拡縮）
(function(){
  // CSS変数から読み取り（未定義ならデフォルト）
  const css = () => getComputedStyle(document.documentElement);
  const num = v => parseFloat(v) || 0;

  function fitStage(){
    const BASE_W = num(css().getPropertyValue('--base-w')) || 1280;
    const BASE_H = num(css().getPropertyValue('--base-h')) || 820;
    const MARGIN = num(css().getPropertyValue('--viewport-margin')) || 32;

    const vw = window.innerWidth  - MARGIN*2;
    const vh = window.innerHeight - MARGIN*2;
    const s  = Math.max(0.5, Math.min(vw/BASE_W, vh/BASE_H)); // 最小縮小率は0.5（必要に応じ調整）
    document.documentElement.style.setProperty('--app-scale', s);
  }

  window.addEventListener('resize', fitStage, { passive:true });
  window.addEventListener('orientationchange', fitStage, { passive:true });
  document.addEventListener('DOMContentLoaded', fitStage);
})();

// ■ 画像ドラッグや長押し選択を抑止（UIの誤操作防止）
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('img').forEach(img => {
    img.addEventListener('mousedown', e => e.preventDefault());
    img.addEventListener('dragstart', e => e.preventDefault());
  });

  // 将来機能フック（クリック時のプレースホルダ）
  const clickable = document.querySelectorAll(
    '.stationery-toolbar img, .history-tool img, .contents-button img, #next-step'
  );
  clickable.forEach(el => el.addEventListener('click', () => {
    // TODO: 実処理を後で追加
    // console.log('clicked:', el.alt || el.id);
  }));
});
